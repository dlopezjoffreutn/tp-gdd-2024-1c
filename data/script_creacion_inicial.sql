USE GD1C2024;
GO

-- Drop constraints

DECLARE @drop_constraints NVARCHAR(max) = ''
SELECT @drop_constraints += 'ALTER TABLE ' + QUOTENAME(OBJECT_SCHEMA_NAME(parent_object_id)) + '.'
                        +  QUOTENAME(OBJECT_NAME(parent_object_id)) + ' ' + 'DROP CONSTRAINT' + QUOTENAME(name)
FROM sys.foreign_keys f

EXEC sp_executesql @drop_constraints;
GO

-- Drop tablas

declare @drop_tablas NVARCHAR(max) = ''
SELECT @drop_tablas += 'DROP TABLE DASE_DE_BATOS.' + QUOTENAME(TABLE_NAME)
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = 'DASE_DE_BATOS' and TABLE_TYPE = 'BASE TABLE'

EXEC sp_executesql @drop_tablas;
GO

DECLARE @drop_procedures NVARCHAR(max) = ''
SELECT @drop_procedures += 'DROP PROCEDURE DASE_DE_BATOS.' + QUOTENAME(NAME)
FROM sys.procedures
WHERE schema_id = SCHEMA_ID('DASE_DE_BATOS')

EXEC sp_executesql @drop_procedures;
GO

IF EXISTS (SELECT name FROM sys.schemas WHERE name = 'DASE_DE_BATOS')
	DROP SCHEMA DASE_DE_BATOS;
GO

-- Creacion de schema
CREATE SCHEMA DASE_DE_BATOS
GO

-- Creacion de tablas

CREATE TABLE DASE_DE_BATOS.CATEGORIAS (
	ID decimal(18, 0) PRIMARY KEY,
	NOMBRE nvarchar(255) not null
);

CREATE TABLE DASE_DE_BATOS.SUBCATEGORIAS (
	ID decimal(18, 0) PRIMARY KEY,
	NOMBRE nvarchar(255) not null,
	CATEGORIA_ID decimal(18, 0) not null,
	CONSTRAINT FK_SUBCATEGORIA_CATEGORIA FOREIGN KEY (CATEGORIA_ID) REFERENCES DASE_DE_BATOS.CATEGORIAS(ID)
);

CREATE TABLE DASE_DE_BATOS.MARCAS (
	ID decimal(18, 0) PRIMARY KEY,
	NOMBRE nvarchar(255) not null
);

CREATE TABLE DASE_DE_BATOS.PRODUCTOS (
	ID decimal(18, 0) PRIMARY KEY,
	NOMBRE nvarchar(255) not null,
	DESCRIPCION nvarchar(255) not null,
	SUBCATEGORIA_ID decimal(18, 0) not null,
	MARCA_ID decimal(18, 0) not null,
	CONSTRAINT FK_PRODUCTO_SUBCATEGORIA FOREIGN KEY (SUBCATEGORIA_ID) REFERENCES DASE_DE_BATOS.SUBCATEGORIAS(ID)
	CONSTRAINT FK_PRODUCTO_MARCA FOREIGN KEY (MARCA_ID) REFERENCES DASE_DE_BATOS.MARCAS(ID),
);

CREATE TABLE DASE_DE_BATOS.PROVINCIAS (
	ID decimal(18, 0) PRIMARY KEY,
	NOMBRE nvarchar(255) not null
);

CREATE TABLE DASE_DE_BATOS.LOCALIDADES (
	ID decimal(18, 0) PRIMARY KEY,
	NOMBRE nvarchar(255) not null,
	PROVINCIA_ID decimal(18, 0) not null,
	CONSTRAINT FK_LOCALIDAD_PROVINCIA FOREIGN KEY (PROVINCIA_ID) REFERENCES DASE_DE_BATOS.PROVINCIAS(ID)
);

CREATE TABLE DASE_DE_BATOS.SUCURSALES (
	ID decimal(18, 0) PRIMARY KEY,
	NOMBRE nvarchar(255) not null,
	DIRECCION nvarchar(255) not null,
	LOCALIDAD_ID decimal(18, 0) not null,
	CONSTRAINT FK_SUCURSAL_LOCALIDAD FOREIGN KEY (LOCALIDAD_ID) REFERENCES DASE_DE_BATOS.LOCALIDADES(ID)
);